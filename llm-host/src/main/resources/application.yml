server:
  port: 8082

spring:
  application:
    name: llm-host
  ai:
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      chat:
        model: ${OLLAMA_CHAT_MODEL:llama3.1:8b}
    openai:
      base-url: ${OPENAI_BASE_URL:http://ollama:11434/v1}
      api-key: ${OPENAI_API_KEY:ollama-local}
      chat:
        options:
          model: ${OPENAI_CHAT_MODEL:llama3.1:8b}
    mcp:
      client:
        enabled: true
        type: SYNC
        initialized: true
        toolcallback:
          enabled: true
        streamable-http:
          connections:
            mcpServer:
              url: ${MCP_SERVER_URL:http://mcp-server:8085}
        request-timeout: 30s

app:
  ai:
    # "openai" peut pointer vers Ollama via OPENAI_BASE_URL.
    provider: ${APP_AI_PROVIDER:ollama}
    ollama:
      chat-model: ${OLLAMA_CHAT_MODEL:llama3.1:8b}
      embedding-model: ${OLLAMA_EMBEDDING_MODEL:nomic-embed-text}
    openai:
      chat-model: ${OPENAI_CHAT_MODEL:gpt-4o-mini}
      embedding-model: ${OPENAI_EMBEDDING_MODEL:text-embedding-3-small}
  tooling:
    max-tool-calls: ${APP_TOOLS_MAX_CALLS:6}
    tool-timeout-seconds: ${APP_TOOLS_TIMEOUT_SECONDS:90}
    dry-run: ${DRY_RUN:false}
    max-prompt-length: ${APP_MAX_PROMPT:4000}
  safety:
    allowlist: ${APP_RAG_ALLOWLIST:https://docs.spring.io,https://github.com}
    rag-top-k: ${APP_RAG_TOP_K:6}
  rag:
    citation-coverage-ratio: ${APP_RAG_CITATION_COVERAGE_RATIO:0.5}
    citation-min-sources-for-coverage: ${APP_RAG_CITATION_MIN_SOURCES:4}
    citation-min-sources-required: ${APP_RAG_CITATION_MIN_REQUIRED:1}
    enable-source-code-pass: ${APP_RAG_ENABLE_SOURCE_CODE_PASS:true}
  system-prompt: |
    Tu es un orchestrateur Spring Boot Upgrade Assistant.
    Rôle: décider des tool-calls MCP (project.*, rag.*, methodology.*) pour répondre.
    Respecte les garde-fous: pas de commandes dangereuses, respect de l'allowlist pour rag.ingestFromHtml.
    Pour le RAG limite topK à ${APP_RAG_TOP_K:6}.
    Quand l'utilisateur demande de restreindre aux dépendances Spring, utilise project.detectSpringScope puis la méthodologie.
    Avant de répondre, appelle methodology.writeReport avec ton contenu pour obtenir le JSON final.
    Réponse finale: JSON valide conforme au contrat UpgradeReport, sans texte hors JSON.
    Contrat JSON UpgradeReport :
    {
      "project": { "repoUrl": "...", "workspaceId":"...", "from":"2.5.x", "to":"2.7.x" },
      "springUsageSummary": {...},
      "impacts": [
         { "id":"IMP-1", "title":"...", "type":"BREAKING_CHANGE|DEPRECATION|BEHAVIOR_CHANGE|DEPENDENCY_UPGRADE",
           "affectedAreas":["web","security"], "evidence":["S2","S5"], "recommendation":"..." }
      ],
      "workpoints": [
         { "impactId":"IMP-1", "points": 3, "rationale":"...", "evidence":["S2"] }
      ],
      "unknowns": [
         { "question":"...", "why":"not enough sources", "nextStep":"ingest ...", "evidence":[] }
      ]
    }
