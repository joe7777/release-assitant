server:
  port: 8085

logging:
  level:
    com.example.mcpserver: INFO
    org.springframework.ai.mcp: DEBUG
    org.springframework.ai: DEBUG
    reactor.netty.http.server: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics,mappings"
  endpoint:
    health:
      probes:
        enabled: true

spring:
  application:
    name: mcp-server
  profiles:
    default: qdrant
  ai:
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://ollama:11434}
      embedding:
        model: ${OLLAMA_EMBEDDING_MODEL:nomic-embed-text}
    mcp:
      server:
        enabled: true
        protocol: STREAMABLE
        # (optionnel si tu veux forcer l’endpoint, sinon /mcp par défaut selon la doc)
        streamable-http:
          mcp-endpoint: /mcp
        annotation-scanner:
          enabled: true
          base-packages:
            - com.example.mcpserver.tools
    embeddings:
      metadata-mode: storage

springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    enabled: true
  paths-to-match:
    - /api/rag/**

mcp:
  workspace-root: ${MCP_WORKSPACE_ROOT:workspaces}
  spring-source:
    cache-root: ${MCP_SPRING_CACHE_ROOT:spring-sources}
    default-max-files: ${SPRING_SOURCE_MAX_FILES:10000}
    default-max-file-bytes: ${SPRING_SOURCE_MAX_FILE_BYTES:600000}
    default-max-lines-per-file: ${SPRING_SOURCE_MAX_LINES_PER_FILE:20000}
    include-tests: ${SPRING_SOURCE_INCLUDE_TESTS:false}
  rag:
    allowlist:
      - https://docs.spring.io
      - https://github.com
    max-content-length: ${RAG_MAX_CONTENT_LENGTH:5242880}
    chunk-size: ${RAG_CHUNK_SIZE:800}
    chunk-overlap: ${RAG_CHUNK_OVERLAP:80}
    embedding-batch-size: ${RAG_EMBEDDING_BATCH_SIZE:24}
    embedding-max-retries: ${RAG_EMBEDDING_MAX_RETRIES:3}
    embedding-backoff-ms: ${RAG_EMBEDDING_BACKOFF_MS:500}
    collection: ${RAG_COLLECTION:mcp_documents}
    baseline-do-ingest: ${RAG_BASELINE_DO_INGEST:false}
    text-normalization: true
  vector-add-timeout-ms: ${VECTOR_ADD_TIMEOUT_MS:90000}
  vector-add-batch-size: ${VECTOR_ADD_BATCH_SIZE:24}
  vector-add-max-retries: ${VECTOR_ADD_MAX_RETRIES:3}
  vector-add-backoff-ms: ${VECTOR_ADD_BACKOFF_MS:500}

---
spring:
  config:
    activate:
      on-profile: qdrant
  ai:
    vectorstore:
      qdrant:
        host: ${QDRANT_HOST:vector-db}
        port: ${QDRANT_PORT:6334}
        collection-name: mcp_documents
        api-key: ${QDRANT_API_KEY:}
        initialize-schema: true
